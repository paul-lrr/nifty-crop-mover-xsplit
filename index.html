<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>Nifty Crop Mover</title>

	<link rel="stylesheet" href="css/style.css">

</head>

<body>
	<div id="app" @keydown.17="slow=true" @keyup.17="slow=false">
		<div id="stage" :style="stage" :class="{slow:slow}">
			<move-resize v-if="xsplit.item.width" ref="moveResize" :frame="frame" :item="item" :oversize="oversize" @set-mode="handleMode"></move-resize>
			<div v-else id="no-item">Please choose an item by clicking on it in XSplit or selecting it in the menu below</div>
		</div>
		<item-select v-if="itemList" :item-list="itemList" v-model="targetItem"></item-select><button @click="setItemList">â†»</button>
	</div>
	</div>
	<script src="js/xjs.min.js"></script>
	<script src="https://cdn.jsdelivr.net/lodash/4.15.0/lodash.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.min.js"></script>
	<script src="js/nifty-crop-mover.vue.js"></script>
	<script>
		let xjs = require('xjs');
		let xjsApp = new xjs.App();
		let app;
		xjs.ready().then(() => {
			initVue();
			app.resizeStage();
			xjs.ExtensionWindow.on('sources-list-select', function(itemId) {
				if (itemId) {
					xjs.Scene.searchItemsById(itemId)
						.then((item) => {
							Promise.all([item.getName(), item.getCustomName(), item.getId()]).then(([name, customName, itemId]) => {
								let itemName = (customName == '' ? name : customName);
								app.targetItem = itemId;
							});
						});
				} else {
					app.clearStage();
				}
			});
			xjs.ExtensionWindow.on('scene-add', function() {
				app.setItemList();
			});
		});
		async function getAllItems() {
			let itemList = [{
				id: 'i12',
				items: []
			}]

			let numScenes = await xjs.Scene.getSceneCount();
			for (let i = 0; i < numScenes; i++) {
				itemList.push({
					id: i,
					items: []
				})
			}
			itemList.forEach(async (value, i) => {
				let scene = await xjs.Scene.getBySceneIndex(value.id);
				value.name = await scene.getName();
				if (value.id == 'i12' && value.name == 'null') {
					itemList = _.drop(itemList);
				} else if (!await scene.isEmpty()) {
					if (value.id == 'i12') {
						value.name = 'Preview';
					}
					let items = await scene.getItems();
					items.forEach(async (item) => {
						value['items'].push({
							id: await item.getId(),
							name: await item.getCustomName() || await item.getName()
						});
					});
				}
			});
			return itemList;
		}
	</script>


</body>